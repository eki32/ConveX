<div class="nota-info">
    <p><strong>üí° C√≥mo usar:</strong></p>
    <ul>
      <li>Ingresa las horas trabajadas en cada d√≠a laborable (L-S).</li>
      <li>Los festivos, domingos y <strong>periodos de vacaciones</strong> est√°n bloqueados autom√°ticamente.</li>
      <li>Usa el bot√≥n de arriba para rellenar autom√°ticamente con 6.5h/d√≠a.</li>
      <li><strong>Doble clic en un d√≠a laborable</strong> para marcarlo como d√≠a de convenio (amarillo).</li>
      <li>Haz clic en la "C" para desmarcar un d√≠a de convenio.</li>
      <li><strong>NUEVO: Manten pulsado en un d√≠a laborable</strong> para marcarlo como baja m√©dica (naranja ü©π).</li>
      <li>Las horas de d√≠as en vacaciones o baja se descuentan autom√°ticamente del total.</li>
    </ul>
  </div>


<div class="calendario-container">
  <div class="calendario-header">
    <h2>Calendario Laboral Bizkaia {{ anio }}</h2>
    <p class="subtitulo">Ingresa las horas trabajadas cada d√≠a para calcular tu exceso de jornada</p>
  </div>

  <div class="acciones-rapidas">
    <button class="btn btn-primary" (click)="rellenarJornadaEstandar(6.5)">
      <i class="bi bi-lightning-fill"></i>
      Rellenar 6.5h/d√≠a (39h/semana)
    </button>
    <button class="btn btn-outline-danger" (click)="limpiarHoras()">
      <i class="bi bi-trash"></i>
      Limpiar todo
    </button>
  </div>

  <div class="resumen-anual">
    <div class="resumen-card">
      <div class="resumen-numero festivo">{{ totalFestivos }}</div>
      <div class="resumen-label">Festivos Oficiales</div>
    </div>
    <div class="resumen-card">
      <div class="resumen-numero convenio">{{ totalDiasConvenio }}</div>
      <div class="resumen-label">D√≠as Convenio</div>
    </div>
    <div class="resumen-card">
      <div class="resumen-numero laborable">{{ totalLaborables }}</div>
      <div class="resumen-label">D√≠as Laborables</div>
    </div>
    <div class="resumen-card destacado">
      <div class="resumen-numero total">{{ totalHorasTrabajadas }}</div>
      <div class="resumen-label">Total Horas Trabajadas</div>
    </div>
  </div>

  <div class="leyenda">
    <div class="leyenda-item">
      <span class="muestra dia-festivo"></span>
      <span>Festivo Oficial</span>
    </div>
    <div class="leyenda-item">
      <span class="muestra dia-convenio"></span>
      <span>D√≠a Convenio</span>
    </div>
    <div class="leyenda-item">
      <span class="muestra dia-vacaciones"></span>
      <span>Vacaciones (Bloqueado)</span>
    </div>
    <div class="leyenda-item">
      <span class="muestra dia-baja"></span>
      <span>Baja M√©dica (Bloqueado)</span>
    </div>
    <div class="leyenda-item">
      <span class="muestra dia-fin-semana"></span>
      <span>Domingo</span>
    </div>
    <div class="leyenda-item">
      <span class="muestra dia-laborable"></span>
      <span>Laborable (L-S)</span>
    </div>
  </div>

  <div class="meses-grid">
    @for (mes of meses; track mes.numero) {
      <div class="mes-card">
        <div class="mes-header">
          <h3>{{ mes.nombre }}</h3>
          @if (getHorasMes(mes) > 0) {
            <span class="horas-mes">{{ getHorasMes(mes) }}h</span>
          }
        </div>

        <div class="calendario-mes">
          <div class="dias-semana">
            @for (diaNom of diasSemana; track diaNom) {
              <div class="dia-semana-header">{{ diaNom }}</div>
            }
          </div>

          <div class="dias-grid">
            @for (dia of mes.dias; track dia.fecha) {
                <div
                [class]="obtenerClaseDia(dia)"
                [class.dia-vacaciones]="dia.esVacaciones"
                [class.dia-baja]="dia.esBaja"
                [title]="dia.descripcion || ''"
                (dblclick)="onDblClick(dia, $event)"
                (mousedown)="onMouseDown(dia, $event)"
                (mouseup)="onMouseUp()"
                (mouseleave)="onMouseUp()"
              >
                @if (dia.dia > 0) {
                  <span class="numero-dia">{{ dia.dia }}</span>
                }
                
                @if (dia.esFestivo) {
                  <span class="indicador-festivo">‚òÖ</span>
                }
                @if (dia.esDiaConvenio && !dia.esVacaciones && !dia.esBaja) {
                  <span class="indicador-convenio" (click)="toggleDiaConvenio(dia, $event)">C</span>
                }
                @if (dia.esVacaciones) {
                  <span class="indicador-vacaciones">üå¥</span>
                }
                @if (dia.esBaja) {
                  <span class="indicador-baja">ü©π</span>
                }

                @if (dia.esLaborable && dia.dia > 0 && !dia.esVacaciones && !dia.esBaja) {
                 <input
                    #inputRef
                    type="number"
                    class="input-horas"
                    [value]="dia.horasTrabajadas || ''"
                    (input)="actualizarHoras(dia, $event, inputRef)"
                    min="0"
                    max="24"
                    step="0.5"
                    placeholder="0h"
                  />
                }

                @if (dia.esVacaciones) {
                  <span class="horas-bloqueadas">0h</span>
                }
                
                @if (dia.esBaja && !dia.esVacaciones) {
                  <span class="horas-bloqueadas">0h</span>
                }

                @if (!dia.esLaborable && dia.dia > 0 && !dia.esVacaciones && !dia.esBaja && dia.horasTrabajadas > 0) {
                  <span class="horas-fijas">
                    {{ dia.horasTrabajadas }}h
                  </span>
                }
              </div>
            }
          </div>
        </div>
      </div>
    }
  </div>

  
</div>